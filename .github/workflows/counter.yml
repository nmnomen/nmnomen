name: Visitor Counter
on:
  page_build:
  workflow_dispatch:

jobs:
  update-counter:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Read current count
        id: count
        run: |
          if [ -f "counter-data.json" ]; then
            COUNT=$(cat counter-data.json)
          else
            COUNT=0
          fi
          echo "current_count=$COUNT" >> $GITHUB_OUTPUT
      
      - name: Increment counter
        run: |
          NEW_COUNT=$((steps.count.outputs.current_count + 1))
          echo $NEW_COUNT > counter-data.json
          
      - name: Update SVG
        run: |
          sed -i "s/Visits: [0-9]*/Visits: $((steps.count.outputs.current_count + 1))/" counter.svg
          
      - name: Commit changes
        uses: EndBug/add-and-commit@v9
        with:
          add: 'counter.svg counter-data.json'
          message: 'Update visitor counter to ${{ steps.count.outputs.current_count + 1 }}'
