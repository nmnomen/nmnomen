name: Visitor Counter

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

permissions:
  contents: write

jobs:
  update-counter:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Update counter
        id: counter
        run: |
          # Initialize counter
          if [ -f "visitor-count.txt" ]; then
            COUNT=$(cat visitor-count.txt)
          else
            COUNT=0
          fi
          
          # Increment counter
          NEW_COUNT=$((COUNT + 1))
          echo $NEW_COUNT > visitor-count.txt
          
          # Create JSON file
          echo '{"schemaVersion":1,"label":"ðŸ‘ï¸ Visits","message":"'$NEW_COUNT'","color":"blue","style":"flat-square"}' > counter.json
          
          echo "count=$NEW_COUNT" >> $GITHUB_OUTPUT
          echo "Counter updated to: $NEW_COUNT"

      - name: Commit changes
        uses: EndBug/add-and-commit@v9
        with:
          message: "Update visitor counter to ${{ steps.counter.outputs.count }}"
          add: "visitor-count.txt counter.json"
